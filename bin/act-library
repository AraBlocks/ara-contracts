#!/usr/bin/env node

const debug = require('debug')('ara-contracts:cli:library')
const { info, warn, error, log } = require('ara-console')
const { createProgram } = require('../lib/program')
const library = require('../library')
const inquirer = require('inquirer')

const toLower = x => String(x).toLowerCase()

// yargs program command line interface instance
const program = createProgram({
  usage: `
usage: act library: [-h] [--help]
                     <did> [options]
`
})

const { argv } = program
  .option('get', {
    alias: 'g',
    type: 'number',
    describe: 'Gets the g\'th item in the library'
  })

// Emit program usage help
if (0 == argv._.length && argv.help) {
  program.showHelp()
  process.exit(0)
}

// Main program entry
module.exports = (async function main() {
  if (1 !== argv._.length) {
    onfatal(new Error('Please supply a single DID whose library you would like to view.'))
  }
  const did = argv._[0]
  const { g } = argv
  if (!g && 0 !== g) {
    const size = await library.getLibrarySize(did)
    const lib = await library.getLibrary(did)
    info(did, 'library (', size, ')\n', lib)
  } else {
    const contentDid = await library.getLibraryItem({ requesterDid: did, index: g })
    info('item', g, 'has did:', contentDid)
  }
}())
